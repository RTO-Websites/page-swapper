var PageSwapper=function(m){var n=window,doc=n.document,self=this,defaultArgs={disableCache:false,debug:false,tabSelector:'.tab',owlConfig:{}},owlDefaultArgs={margin:20,mouseDrag:false,touchDrag:false,},container=null,host='http://'+n.location.host,currentUrl=n.location.href,hash='',tabSelector=null,debug,loadComplete,checkHash,changeUrl,addIdPrefixes,removeIdPrefixes,finish,init;init=function(){m=jQuery.extend(defaultArgs,m);m.id='page-swapper';container=jQuery(jQuery(m.container)[0]);tabSelector=m.tabSelector;container.wrapInner('<div class="tab psw-starttab" data-url="'+n.location.href+'"></div>');container.addClass('psw-container');container.addClass('owl-carousel');jQuery('body').on('click','a:not(a[href*=".jpg"], a[href*=".jpeg"], a[href*=".png"], a[href*=".gif"], a[href*=".JPG"], a[href*=".GIF"], a[href*=".PNG"], a[href*=".JPEG"])',self.linkClick);jQuery(n).on('popstate',function(){self.open(doc.location.href)});var a=jQuery.extend(owlDefaultArgs,m.owlConfig);a=jQuery.extend(a,{items:1,autoHeight:true,});container.owlCarousel(a);var b=container.find('.psw-starttab').parent();b.data('url',n.location.href)b.data('title',doc.title)b.data('bodyclass',jQuery('body').prop('class').replace('no-js',''));debug('psw init',self,container,m)};self.linkClick=function(a){if(!a||!a.target){return}var b=jQuery(a.target);if(!b.is('a')){b=b.closest('a')}if(!b.prop('href')){return}if(b.hasClass('no-ajax')){return}var c=b.prop('href');if(c.indexOf(host)===-1){return}if(c.indexOf('mailto:')!==-1){return}var d=['zip','exe','rar','pdf','doc','gif','png','jpg','jpeg','bmp','mp4','mp3'],fileEnding=c.split('.');fileEnding=fileEnding[fileEnding.length-1];if(jQuery.inArray(fileEnding,d)!==-1){return}a.preventDefault();self.open(c)};self.open=function(d){var e=d.split('#');hash='';d=e[0];if(typeof(e[1])!=='undefined'){hash=e[1]}container.trigger('psw-beforeopen',{'container':container,'url':d,'hash':hash,'currentUrl':currentUrl});debug('psw beforeOpen',self,container,m,d,hash,currentUrl);if(currentUrl===d){checkHash();return}var f=container.find('.owl-item[data-url="'+d+'"]');if(f.length>0){self.openFromCache(f,d);return}jQuery('body').removeClass('psw-finish-loading').addClass('psw-loading');jQuery.ajax({dataType:'text',type:'GET',url:d,data:null,success:function(a,b,c){loadComplete(a,b,d,c)},error:function(){jQuery('body').removeClass('psw-loading');jQuery('body').addClass('psw-loaderror');errorTimeout=setTimeout(function(){jQuery('body').removeClass('psw-loaderror')},1000)}});container.trigger('psw-loadstart',{'container':container,'url':d,'hash':hash,'currentUrl':currentUrl});debug('psw loadstart',self,container,m,d,hash,currentUrl)};loadComplete=function(a,b,c,d){jQuery('body').removeClass('psw-loading').addClass('psw-finish-loading');var f=jQuery('<div class="tab" />');if(!d){return false}var g=d.getResponseHeader('Content-Type');if(g.indexOf('text/html')===-1){return false}debug('psw loadComplete',self,container,m,c,hash,currentUrl,d);var h=container.find('> .active'),title=a.match(/<title>(.*?)<\/title>/);if(title&&title[1]){title=title[1]}else{title=''}a=a.replace('<body','<body><div id="psw-body"').replace('</body>','</div></body');var i=jQuery.parseHTML(a,true);i=jQuery(i);if(i.filter('#psw-body').length>0){var j=i.filter('#psw-body').prop('class').replace('no-js','');var k=jQuery('body').prop('class');if(m.selector==='body'){j+=' page-swapper '}jQuery('body').removeClass(k).addClass(j);f.parent().data('bodyclass',j)}var l=i.find(m.selector);if(l.length===0){l=i.filter('#psw-body')}container.trigger('add.owl.carousel',f);container.trigger('refresh.owl.carousel');addIdPrefixes(h);try{f.html(l.html())}catch(e){l.find('script').remove();f.html(l.html())}changeUrl(c,title);f.parent().attr('data-url',c).data('title',title);container.trigger('to.owl.carousel',f.parent().index());finish(f.parent(),{'container':container,'oldTab':h,'newTab':f.parent(),'url':c,'currentUrl':currentUrl})};self.openFromCache=function(a,b){addIdPrefixes(container.find('> .active'));removeIdPrefixes(a);var c=a.html();a.empty().html(c);changeUrl(b,a.data('title'));debug('psw openFromCache',b,a);var d=a.data('bodyclass');if(m.selector==='body'){d+=' page-swapper '}jQuery('body').removeClass(jQuery('body').prop('class')).addClass(d);finish(a,{'container':container,'oldTab':container.find('> .active'),'newTab':a,'url':b,})};finish=function(a,b){container.trigger('psw-loadcomplete',b);container.trigger('to.owl.carousel',a.index());if(typeof _gaq!=="undefined"&&_gaq!==null){_gaq.push(['_trackPageview',m.url])}}checkHash=function(){debug('psw checkHash',self,container,m,hash,currentUrl);if(hash&&jQuery('#'+hash).length>0){jQuery('html,body').animate({scrollTop:jQuery('#'+hash).offset().top},600);hash=''}};addIdPrefixes=function(c){c.find('*').each(function(a,b){if(b.id.length>0){b.id='psw-rm-'+b.id}})};removeIdPrefixes=function(c){c.find('*').each(function(a,b){if(b.id.length>0){b.id=b.id.replace('psw-rm-','')}})};changeUrl=function(a,b){currentUrl=a;if(n.history&&typeof(n.history.pushState)!=='undefined'){n.history.pushState({},b,a);doc.title=b}};self.changeCurrentUrl=function(a){currentUrl=a};debug=function(){if(m.debug){console.info(arguments)}};self._debug=function(){if(m.debug){m.debug=false}else{m.debug=true}};init()};jQuery.fn.pageSwapper=function(c){if(typeof(c)==='undefined'){c={}}c.selector=this.selector;this.each(function(a,b){if(typeof(document.pageSwapperInstance)==='undefined'){c.container=jQuery(b);document.pageSwapperInstance=new PageSwapper(c)}})};