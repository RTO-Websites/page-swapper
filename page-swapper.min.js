var PageSwapper=function(h){var i=window,doc=i.document,self=this,defaultArgs={disableCache:false,debug:false,owlConfig:{},owlVersion:2,},owlDefaultArgs={margin:20,mouseDrag:false,touchDrag:false,disableHash:false},container=null,host='http://'+i.location.host,currentUrl=i.location.href,hash='',initFailed=false,pswXhr=null;var j=function(){if(!i.$){i.$=jQuery}h=$.extend(defaultArgs,h);h.id='page-swapper';container=$($(h.container)[0]);if(container.is('body')){container.wrapInner('<div class="psw-body"></div>');container=container.find('> .psw-body')}container.wrapInner('<div class="tab psw-starttab psw-tab"></div>');$('body').on('click','a:not(a[href*=".jpg"], a[href*=".jpeg"], a[href*=".png"], a[href*=".gif"], a[href*=".JPG"], a[href*=".GIF"], a[href*=".PNG"], a[href*=".JPEG"])',self.linkClick);$(i).on('popstate',function(){self.open(doc.location.href)});var a=$.extend(owlDefaultArgs,h.owlConfig);a=$.extend(a,{items:1,singleItem:true,autoHeight:true,});container.addClass('psw-container');try{container.owlCarousel(a)}catch(e){initFailed=true;console.info('psw-init-error',e,container,a);return}var b=container.find('.psw-starttab');b.attr('data-url',i.location.href);b.data('title',doc.title);b.data('bodyclass',$('body').prop('class').replace('no-js',''));b.data('originalhtml','');w('psw init',self,container,h);if(container.data('owl.carousel')&&container.data('owl.carousel')._plugins&&container.data('owl.carousel')._plugins.autoHeight){setInterval(function(){container.data('owl.carousel')._plugins.autoHeight.update()},300)}self.setClasses()};self.setArgs=function(a){h=$.extend(h,a)};self.linkClick=function(a){if(!a||!a.target||initFailed){return}var b=$(a.target);if(!b.is('a')){b=b.closest('a')}if(!b.prop('href')){return}if(b.hasClass('no-ajax')){return}var c=b.prop('href');if(c.indexOf(host)===-1){return}if(c.indexOf('mailto:')!==-1){return}var d=['zip','exe','rar','pdf','doc','gif','png','jpg','jpeg','bmp','mp4','mp3'],fileEnding=c.split('.');fileEnding=fileEnding[fileEnding.length-1];if($.inArray(fileEnding,d)!==-1){return}a.preventDefault();self.open(c,a)};self.open=function(d,e){var f=d.split('#');hash='';d=f[0];if(typeof(f[1])!=='undefined'){hash=f[1]}container.trigger('psw-beforeopen',{'container':container,'url':d,'hash':hash,'currentUrl':currentUrl,'clickEvent':e,});w('psw beforeOpen',self,container,h,d,hash,currentUrl);if(currentUrl===d){n();return}var g=m(d);if(g){return}$('body').removeClass('psw-finish-loading').addClass('psw-loading');if(pswXhr){pswXhr.abort();pswXhr=null}pswXhr=$.ajax({dataType:'text',type:'GET',url:d,data:{pswLoad:1},success:function(a,b,c){k(a,b,d,c)},error:function(){$('body').removeClass('psw-loading');$('body').addClass('psw-loaderror');errorTimeout=setTimeout(function(){$('body').removeClass('psw-loaderror')},1000)}});container.trigger('psw-loadstart',{'container':container,'url':d,'hash':hash,'currentUrl':currentUrl,'clickEvent':e,});w('psw loadstart',self,container,h,d,hash,currentUrl)};var k=function(a,b,c,d){$('body').removeClass('psw-loading').addClass('psw-finish-loading');var e=$('<div class="tab psw-tab" />'),currentTab=self.getCurrent(),title='',bodyClass='';if(!d){return false}var f=d.getResponseHeader('Content-Type');if(f.indexOf('text/html')===-1){return false}w('psw loadComplete',self,container,h,c,hash,currentUrl,d);title=v(a);content=s(a);if(h.owlVersion==1){container.data('owlCarousel').addItem(e);self.setClasses()}else{container.trigger('add.owl.carousel',e);container.trigger('refresh.owl.carousel')}o(currentTab);e.data('originalhtml',content.html());u(e,content);r(c,title);e.attr('data-url',c).data('title',title);e.data('bodyclass',bodyClass);e.parent().addClass('psw-item');l(e.parent(),{'container':container,'oldTab':currentTab,'newTab':e.parent(),'url':c,'currentUrl':currentUrl})};self.openFromCache=function(a,b,c){var d=self.getCurrent();o(d);q(a.parent());var e=a.data('originalhtml');if(!e||!e.length){t(a)}else{a.empty().html(e)}r(b,a.data('title'));w('psw openFromCache',b,a,e);var f=a.data('bodyclass');if(h.selector==='body'){f+=' page-swapper '}$('body').removeClass($('body').prop('class')).addClass(f);l(a.parent(),{'container':container,'oldTab':self.getCurrent(),'newTab':a.parent(),'url':b,})};var l=function(a,b){container.trigger('psw-loadcomplete',b);self.jumpTo(a.index());w('psw finish',a,a.index());if(typeof _gaq!=="undefined"&&_gaq!==null){_gaq.push(['_trackPageview',h.url])}if(typeof(ga)!=='undefined'&&ga!==null){ga('send','pageview',location.pathname)}};self.jumpTo=function(a){if(h.owlVersion==1){console.info('jump',a,container.data('owlCarousel'));container.data('owlCarousel').goTo(a)}else{container.trigger('to.owl.carousel',a)}};var m=function(a){var b=container.find('.psw-tab[data-url="'+a+'"]');if(!b.length){b=container.find('.psw-tab[data-url="'+a+'/"]')}if(b.length>0){self.openFromCache(b,a,event);return true}return false};var n=function(){w('psw checkHash',self,container,h,hash,currentUrl);if(!h.disableHash&&hash&&$('#'+hash).length>0){$('html,body').animate({scrollTop:$('#'+hash).offset().top},600);hash=''}};var o=function(c){c.find('*').each(function(a,b){if(b.id.length>0){b.id='psw-rm-'+b.id}})};var p=function(a){if(h.owlVersion==1){container.data('owlCarousel').removeItem(a.index());self.setClasses()}else{container.trigger('remove.owl.carousel',a.index());container.trigger('refresh.owl.carousel')}};var q=function(c){c.find('*').each(function(a,b){if(b.id.length>0){b.id=b.id.replace('psw-rm-','')}})};self.setClasses=function(){container.addClass('psw-container');container.addClass('owl-carousel');container.find('> .owl-stage-outer, > .owl-wrapper-outer').addClass('psw-stage-outer');container.find('> .owl-stage-outer > .owl-stage, > .owl-wrapper-outer > .owl-wrapper').addClass('psw-stage');container.find('.psw-stage > .owl-item').addClass('psw-item')};self.getCurrent=function(){var a;if(h.owlVersion==1){a=container.find('.psw-item:nth-child('+container.data('owlCarousel').currentItem+')')}else{a=container.find('.psw-item.active')}return a};var r=function(a,b){currentUrl=a;if(i.history&&typeof(i.history.pushState)!=='undefined'){i.history.pushState({},b,a);doc.title=jQuery('<textarea />').html(b).text()}};var s=function(a){a=a.replace('<body','<body><div id="psw-body"').replace('</body>','</div></body');var b=$.parseHTML(a,true);b=$(b);if(b.filter('#psw-body').length>0){bodyClass=b.filter('#psw-body').prop('class').replace('no-js','');var c=$('body').prop('class');if(h.selector==='body'){bodyClass+=' page-swapper '}$('body').removeClass(c).addClass(bodyClass)}var d=b.find(h.selector);if(d.length===0){d=b.filter('#psw-body')}return d};var t=function(e){w('psw getOrgHtml',e,e.data('url'));pswXhr=$.ajax({dataType:'text',type:'GET',url:e.data('url'),data:{pswLoad:1},success:function(a,b,c){var d=s(a);e.data('originalhtml',d.html());u(e,d);w('psw getOrgHtml finish',e,d.html())},})};var u=function(a,b){try{a.empty().html(b.html())}catch(e){b.find('script').remove();a.empty().html(b.html())}};var v=function(a){var b=a.match(/<title>(.*?)<\/title>/);if(b&&b[1]){b=b[1]}else{b=''}return b};self.changeCurrentUrl=function(a){currentUrl=a};var w=function(){if(h.debug){console.info(arguments)}};self._debug=function(a){h.debug=a};j()};jQuery.fn.pageSwapper=function(c){if(typeof(c)==='undefined'){c={}}c.selector=this.selector;this.each(function(a,b){if(typeof(document.pageSwapperInstance)==='undefined'){c.container=jQuery(b);document.pageSwapperInstance=new PageSwapper(c)}})};