var PageSwapper=function(args){var win=window,doc=win.document,self=this,defaultArgs={disableCache:false,debug:false,tabSelector:'.tab',owlConfig:{}},owlDefaultArgs={margin:20,mouseDrag:false,touchDrag:false,},container=null,host='http://'+win.location.host,currentUrl=win.location.href,hash='',tabSelector=null,debug,loadComplete,checkHash,changeUrl,addIdPrefixes,removeIdPrefixes,init;init=function(){args=jQuery.extend(defaultArgs,args);args.id='page-swapper';container=jQuery(jQuery(args.container)[0]);tabSelector=args.tabSelector;container.wrapInner('<div class="tab" data-url="'+win.location.href+'"></div>');container.addClass('psw-container');container.addClass('owl-carousel');jQuery('body').on('click','a:not(a[href*=".jpg"], a[href*=".jpeg"], a[href*=".png"], a[href*=".gif"], a[href*=".JPG"], a[href*=".GIF"], a[href*=".PNG"], a[href*=".JPEG"])',self.linkClick);jQuery(win).on('popstate',function(){self.open(doc.location.href)});var owlArgs=jQuery.extend(owlDefaultArgs,args.owlConfig);owlArgs=jQuery.extend(owlArgs,{items:1,autoHeight:true,});container.owlCarousel(owlArgs);container.find('> .owl-item').data('url',win.location.href);container.find('> .owl-item').data('title',doc.title).data('bodyclass',jQuery('body').prop('class').replace('no-js',''));debug('psw init',self,container,args)};self.linkClick=function(event){if(!event||!event.target){return}var clickedElement=jQuery(event.target);if(!clickedElement.is('a')){clickedElement=clickedElement.closest('a')}if(!clickedElement.prop('href')){return}if(clickedElement.hasClass('no-ajax')){return}var url=clickedElement.prop('href');if(url.indexOf(host)===-1){return}if(url.indexOf('mailto:')!==-1){return}var filteredFileEndings=['zip','exe','rar','pdf','doc','gif','png','jpg','jpeg','bmp','mp4','mp3'],fileEnding=url.split('.');fileEnding=fileEnding[fileEnding.length-1];if(jQuery.inArray(fileEnding,filteredFileEndings)!==-1){return}event.preventDefault();self.open(url)};self.open=function(url){var splittedUrl=url.split('#');hash='';url=splittedUrl[0];if(typeof(splittedUrl[1])!=='undefined'){hash=splittedUrl[1]}container.trigger('psw-beforeopen',{'container':container,'url':url,'hash':hash,'currentUrl':currentUrl});debug('psw beforeOpen',self,container,args,url,hash,currentUrl);if(currentUrl===url){checkHash();return}var cacheElement=container.find('.owl-item [data-url="'+url+'"]');if(cacheElement.length>0){self.openFromCache(cacheElement,url,hash);debug('psw open from cache',self,container,args,url,hash,currentUrl);return}jQuery('body').removeClass('psw-finish-loading').addClass('psw-loading');jQuery.ajax({dataType:'text',type:'GET',url:url,data:null,success:function(data,textStatus,jqXHR){loadComplete(data,textStatus,url,jqXHR)},error:function(){jQuery('body').removeClass('psw-loading');jQuery('body').addClass('psw-loaderror');errorTimeout=setTimeout(function(){jQuery('body').removeClass('psw-loaderror')},1000)}});container.trigger('psw-loadstart',{'container':container,'url':url,'hash':hash,'currentUrl':currentUrl});debug('psw loadstart',self,container,args,url,hash,currentUrl)};loadComplete=function(data,textStatus,url,jqXHR){jQuery('body').removeClass('psw-loading').addClass('psw-finish-loading');var newTab=jQuery('<div class="tab" />');if(!jqXHR){return false}var contentHeader=jqXHR.getResponseHeader('Content-Type');if(contentHeader.indexOf('text/html')===-1){return false}debug('psw loadComplete',self,container,args,url,hash,currentUrl,jqXHR);var currentTab=container.find('> .active');var title=data.match(/<title>(.*?)<\/title>/);if(title&&title[1]){title=title[1]}else{title=''}data=data.replace('<body','<body><div id="psw-body"').replace('</body>','</div></body');var newHtml=jQuery.parseHTML(data,true);newHtml=jQuery(newHtml);if(newHtml.filter('#psw-body').length>0){var bodyClass=newHtml.filter('#psw-body').prop('class').replace('no-js','');var oldClasses=jQuery('body').prop('class');if(args.selector==='body'){bodyClass+=' page-swapper '}jQuery('body').removeClass(oldClasses).addClass(bodyClass);newTab.data('bodyclass',bodyClass)}var content=newHtml.find(args.selector);if(content.length===0){content=newHtml.filter('#psw-body')}container.trigger('add.owl.carousel',newTab);container.trigger('refresh.owl.carousel');addIdPrefixes(currentTab);try{newTab.html(content.html())}catch(e){content.find('script').remove();newTab.html(content.html())}changeUrl(url,title);newTab.parent().attr('data-url',url).data('title',title);container.trigger('to.owl.carousel',newTab.parent().index());container.trigger('psw-loadcomplete',{'container':container,'oldTab':currentTab,'newTab':newTab,'url':url,'currentUrl':currentUrl});if(typeof _gaq!=="undefined"&&_gaq!==null){_gaq.push(['_trackPageview',args.url])}};self.openFromCache=function(element,url){addIdPrefixes(container.find('> .active'));removeIdPrefixes(element);var oldHtml=element.html();element.empty().html(oldHtml);changeUrl(url,element.data('title'));debug('psw openFromCache',url,element);var bodyClass=element.data('bodyclass');jQuery('body').removeClass(jQuery('body').prop('class')).addClass(bodyClass);container.trigger('to.owl.carousel',element.index())};checkHash=function(){debug('psw checkHash',self,container,args,hash,currentUrl);if(hash&&jQuery('#'+hash).length>0){jQuery('html,body').animate({scrollTop:jQuery('#'+hash).offset().top},600);hash=''}};addIdPrefixes=function(tab){tab.find('*').each(function(index,element){if(element.id.length>0){element.id='psw-rm-'+element.id}})};removeIdPrefixes=function(tab){tab.find('*').each(function(index,element){if(element.id.length>0){element.id=element.id.replace('psw-rm-','')}})};changeUrl=function(url,title){currentUrl=url;if(win.history&&typeof(win.history.pushState)!=='undefined'){win.history.pushState({},title,url);doc.title=title}};self.changeCurrentUrl=function(url){currentUrl=url};debug=function(){if(args.debug){console.info(arguments)}};self._debug=function(){if(args.debug){args.debug=false}else{args.debug=true}};init()};jQuery.fn.pageSwapper=function(args){if(typeof(args)==='undefined'){args={}}args.selector=this.selector;this.each(function(index,element){if(typeof(document.pageSwapperInstance)==='undefined'){args.container=jQuery(element);document.pageSwapperInstance=new PageSwapper(args)}})};